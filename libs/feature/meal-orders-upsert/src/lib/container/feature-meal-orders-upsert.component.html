<shared-ui-stepper-sideboard #cdkStepper [title]="'This is title'">
  <cdk-step>
    <ng-template cdkStepLabel> Meals</ng-template>
    <shared-ui-section-group [title]="'Meals'">
      <shared-ui-section [icon]="'add_shopping_cart'">
        <ng-container title>

          <div class="search-meal-container">
            <div class="search-meal-container__category">
              <mat-form-field appearance="outline">
                <mat-label>Category</mat-label>
                <mat-select [(ngModel)]="selectedCategoryId" name="category">
                  <mat-option *ngFor="let category of categories$|async" [value]="category.id">
                    {{ category.name }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="search-meal-container__search">
              <mat-form-field appearance="outline">
                <mat-label>Meal name</mat-label>
                <input matInput type="text" [(ngModel)]="searchValue" (keyup)="onSearchKeyUp($event)">
                <button *ngIf="searchValue" matSuffix mat-icon-button aria-label="Clear" (click)="searchValue=''">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-form-field>
            </div>

            <div class="search-meal-container__btn">
              <button mat-stroked-button color="primary" (click)="searchMeals()">Search</button>
            </div>
          </div>


        </ng-container>

        <ng-container content>
          <div class="table-host-container">
            <hub-meals-table (addToCartEmitter)="onAddToCart($event)"></hub-meals-table>
          </div>
        </ng-container
        >

        <ng-container footer>

        </ng-container>
      </shared-ui-section>

    </shared-ui-section-group>
  </cdk-step>
  <cdk-step>
    <ng-template cdkStepLabel> Delivery information</ng-template>
    <shared-ui-section-group [title]="'Customer'">
      <shared-ui-section [icon]="'perm_identity'">
        <ng-container title>
          <p>Customer search</p>
        </ng-container>
        <ng-container title-right>
          <div *ngIf="mode === 0">
            <button mat-flat-button color="primary" (click)="createNewCustomer()"><mat-icon>add</mat-icon>New customer</button>
          </div>
          <div *ngIf="mode === 1" class="edit-buttons">
            <button mat-flat-button color="primary" (click)="saveCustomer()"><mat-icon>save</mat-icon>Save</button>
            <button mat-flat-button color="accent" (click)="cancelEdit()"><mat-icon>cancel</mat-icon>Cancel</button>
          </div>
        </ng-container>

        <ng-container content>
          <div class="delivery-container">

            <div class="delivery-container-customer" [formGroup]="form">
              <div>
                <mat-form-field appearance="outline" id="customer-search-field">
                  <mat-icon matPrefix>search</mat-icon>
                  <mat-icon
                    (click)="resetCustomerValue()"
                    *ngIf="searchTermControl.value && searchTermControl.enabled"
                    matSuffix
                  >close
                  </mat-icon>
                  <input
                    type="text"
                    #autocompleteInput="matAutocompleteTrigger"
                    matInput
                    placeholder="Search by name, surname or address..."
                    [formControl]="searchTermControl"
                    [matAutocomplete]="placeAutocomplete"
                    [readonly]="!!selectedCustomer"
                  />
                  <mat-autocomplete
                    #placeAutocomplete="matAutocomplete"
                    [displayWith]="getOptionText"
                    (optionSelected)="onCustomerSelected($event.option.value)"
                    class="customer-search-autocomplete"
                  >
                    <div
                      *ngIf="customerSearchList$ | async as customerList"
                      class="customer-autocomplete__options"
                    >
                      <mat-option
                        *ngIf="!customerList.length && (showNoDataFound$ | async)"
                        [disabled]="true"
                      > Nothing found
                      </mat-option>

                      <mat-option *ngFor="let customer of customerList" [value]="customer">
                        <div class="customer-autocomplete__options__main-info">
                          {{ customer.firstName }} {{ customer.lastName }}
                        </div>

                        <div class="customer-autocomplete__options__additional-info">
                          {{ customer.address }} {{ customer.city }}
                        </div>
                      </mat-option>
                    </div>
                  </mat-autocomplete>
                  <mat-spinner
                    *ngIf="isLoading$ | async"
                    matSuffix
                    [diameter]="17"
                  ></mat-spinner>
                </mat-form-field>
              </div>

              <div>
                <mat-form-field appearance="outline">
                  <mat-label>First name</mat-label>
                  <input matInput type="text" formControlName="firstName" >
                </mat-form-field>
              </div>
              <div>
                <mat-form-field appearance="outline">
                  <mat-label>Last name</mat-label>
                  <input matInput type="text" formControlName="lastName">
                </mat-form-field>
              </div>
              <div>
                <mat-form-field appearance="outline">
                  <mat-label>City</mat-label>
                  <input matInput type="text" formControlName="city">
                </mat-form-field>
              </div>
              <div>
                <mat-form-field appearance="outline">
                  <mat-label>Address</mat-label>
                  <input matInput type="text" formControlName="address">
                </mat-form-field>
              </div>
              <div class="lat-lng-container">
                <mat-form-field appearance="outline" class="disabled">
                  <mat-label>Latitude</mat-label>
                  <input matInput type="text" formControlName="latitude" [readonly]="true">
                </mat-form-field>
                <mat-form-field appearance="outline" class="disabled">
                  <mat-label>Longitude</mat-label>
                  <input matInput type="text" formControlName="longitude" [readonly]="true">
                </mat-form-field>
              </div>

              <div class="update-buttons">
                <button *ngIf="selectedCustomer && mode === 0" mat-flat-button color="primary" (click)="onUpdateCustomer()">Update</button>
                <button *ngIf="selectedCustomer && mode === 2" mat-flat-button color="primary" (click)="onUpdateCustomerSave()">Save</button>
                <button *ngIf="selectedCustomer && mode === 2" mat-flat-button color="accent" (click)="onCancelEdit()">Cancel</button>
              </div>

            </div>
            <div class="delivery-container-location" [formGroup]="form">

              <mat-form-field appearance="outline" id="location-search-field">
                <mat-icon matPrefix>search</mat-icon>
                <mat-icon
                  (click)="resetLocationValue()"
                  *ngIf="searchLocationControl.value && searchLocationControl.enabled"
                  matSuffix
                >close
                </mat-icon>
                <input type="text" placeholder="Search location..." aria-label="Location"
                       matInput [formControl]="searchLocationControl" [matAutocomplete]="autoLocation"
                       [readonly]="selectedLocation">
                <mat-autocomplete #autoLocation="matAutocomplete"
                                  (optionSelected)="onLocationSelected($event.option.value)"
                                  [displayWith]="getLocationText"
                >
                  <mat-option *ngFor="let option of filteredLocations | async" [value]="option">
                    {{option.formatted_address}}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>


              <div *ngIf="apiLoaded | async">
                <google-map height="400px"
                            width="100%"
                            [center]="center"
                            [zoom]="zoom"
                            (mapClick)="moveMap($event)"
                            (mapMousemove)="move($event)">
                  <map-marker  #marker="mapMarker"
                               *ngFor="let markerPosition of markerPositions"
                               [position]="markerPosition"
                               [options]="markerOptions"
                               (mapClick)="openInfoWindow(marker)"
                  ></map-marker>
                  <map-info-window>Info Window content</map-info-window>
                </google-map>
              </div>
            </div>

          </div>

        </ng-container>

        <ng-container footer>

        </ng-container>
      </shared-ui-section>

    </shared-ui-section-group>

  </cdk-step>

  <ng-container sidebar>
    <shared-ui-sideboard>
      <ng-container title>
        <div class="title">Cart</div>
      </ng-container>

      <ng-container title-right>
        <button mat-icon-button [disabled]="false" (click)="emptyCart()">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </ng-container>

      <ng-container content>
        <meal-order-cart-small
          [items]="cartItems$|async"
          (itemsChanged)="onItemsChanged($event)"
        >

        </meal-order-cart-small>
      </ng-container>
    </shared-ui-sideboard>

    <shared-ui-sideboard>
      <ng-container title>
        <div class="title">Toppings</div>
      </ng-container>

      <ng-container title-right>
        <button mat-icon-button type="secondary" [disabled]="false">
          <mat-icon>delete_forever</mat-icon>
        </button>
      </ng-container>

      <ng-container content>
        <div class="top">
          <div class="text-small top__title">Content</div>
          <div class="text-tiny secondary-color">Content 2</div>
        </div>
      </ng-container>
    </shared-ui-sideboard>
  </ng-container>

  <ng-container footer>
    <div class="footer__wrapper">
      <button mat-stroked-button color="primary">Back</button>
      <button mat-stroked-button color="primary">Next</button>
    </div>
  </ng-container>
</shared-ui-stepper-sideboard>
